{#{% extends "team/base.html" %}#}
{% load user_tags %}
{% load staticfiles %}
{% block css %}

    <!-- Datatables -->
    <link href="{% static "vendor/datatable/Bootstrap3/DataTables/DataTables-1.10.16/css/dataTables.bootstrap.min.css" %}"
          rel="stylesheet" type="text/css">
    <link href="{% static "vendor/datatable/Bootstrap3/DataTables/Buttons-1.5.1/css/buttons.bootstrap.min.css" %}"
          rel="stylesheet" type="text/css">
    <link href="{% static "vendor/datatable/Bootstrap3/DataTables/FixedHeader-3.1.3/css/fixedHeader.bootstrap.min.css" %}"
          rel="stylesheet" type="text/css">
    <link href="{% static "vendor/datatable/Bootstrap3/DataTables/Responsive-2.2.1/css/responsive.bootstrap.min.css" %}"
          rel="stylesheet" type="text/css">
    <link href="{% static "vendor/datatable/Bootstrap3/DataTables/Scroller-1.4.4/css/scroller.bootstrap.min.css" %}"
          rel="stylesheet" type="text/css">
    <!-- Datatables -->

{% endblock %}
{% block pageTitle %}
    <h3 class="titleTop">Bookings</h3>
{% endblock %}
{% block content %}
{#    <div class="right_col" role="main">#}
        <div class="clearfix"></div>
        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                    <div class="x_content">
                        <table id="booking-data-table"
                               class="table table-striped table-bordered dt-responsive nowrap"
                               cellspacing="0" width="100%" data-page-length='25'>
                            <thead>
                            <tr>
                                <th>Bkg Creation Date</th>
                                <th>Shipment Date</th>
                                <th>Delivered Date</th>
                                <th>Booking ID</th>
                                <th>LR Number(s)</th>
                                <th>Company Name (Booked By)</th>
                                <th>Company Code (Booked By)</th>
                                <th>Company Name (Consignor)</th>
                                <th>Company Name (Consignee)</th>
                                <th>Customer Name (to Be Billed)</th>
                                <th>Customer Code (to Be Billed)</th>
                                <th>From</th>
                                <th>To</th>
                                <th>Truck Number</th>
                                <th>Truck Type</th>
                                <th>Party Weight</th>
                                <th>Party Rate</th>
                                <th>Freight Revenue</th>
                                <th>Additional charges if any</th>
                                <th>Remarks for additional charge</th>
                                <th>Discount/ Deductions</th>
                                <th>Remarks for Discount / Deductions</th>
                                <th>Net Invoice Amt receivable</th>
                                <th>Refund Amt due</th>
                                <th>Refund Amt Paid</th>
                                <th>In Ward Payments (CNCA)</th>
                                <th>In Ward Payments (others)</th>
                                <th>TDS deducted by Customers</th>
                                <th>Credit Note (CNC)</th>
                                <th>Debit Note (DNC)</th>
                                <th>Balance Amt receivable</th>
                                <th>Invoice Status</th>
                                <th>Invoice Number</th>
                                <th>Invoice Date</th>
                                <th>Supplier Name</th>
                                <th>Supplier Code</th>
                                <th>Supplier Weight</th>
                                <th>Supplier Rate</th>
                                <th>Freight to Supplier</th>
                                <th>Loading Chgs</th>
                                <th>Unloading Chgs</th>
                                <th>Detention Chgs</th>
                                <th>Any other deduction</th>
                                <th>Remarks for other deduction</th>
                                <th>TDS Deducted from Suppliers</th>
                                <th>Total Amount to Supplier</th>
                                <th>Total Out Ward Payment</th>
                                <th>Credit Note - Supplier (CNS)</th>
                                <th>Debit Note - Supplier (DNS)</th>
                                <th>Balance Amt Payable</th>
                                <th>POD Status</th>
                                <th>Source Office</th>
                                <th>Destination Office</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>
{#    </div>#}
{% endblock %}
{% block js %}
    <!-- Datatables -->
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/DataTables-1.10.16/js/jquery.dataTables.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/DataTables-1.10.16/js/dataTables.bootstrap.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/Buttons-1.5.1/js/dataTables.buttons.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/Buttons-1.5.1/js/buttons.bootstrap.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/Buttons-1.5.1/js/buttons.flash.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/Buttons-1.5.1/js/buttons.html5.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/Buttons-1.5.1/js/buttons.print.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/FixedHeader-3.1.3/js/dataTables.fixedHeader.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/KeyTable-2.3.2/js/dataTables.keyTable.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/Responsive-2.2.1/js/dataTables.responsive.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/Responsive-2.2.1/js/responsive.bootstrap.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/Scroller-1.4.4/js/dataTables.scroller.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/JSZip-2.5.0/jszip.min.js" %}" type="text/javascript"></script>
    <!-- Datatables -->
    <script type="text/javascript" language="javascript" class="init">
        $(document).ready(function () {
            var date = new Date();
            var options = {
                weekday: "short", year: "numeric", month: "short",
                day: "numeric", hour: "2-digit", minute: "2-digit"
            };
            $('#booking-data-table').dataTable({
                "serverSide": true,
                "processing": true,
                dom: 'Bfrtip',
                lengthMenu: [
                    [10, 25, 50, 100, 500, 12000],
                    ['10 Records', '25 Records', '50 Records', '100 Records', '500 Records', 'All Records']
                ],
                buttons: [
                    'pageLength', {
                        extend: 'excelHtml5',
                        title: 'Booking Records ' + date.toLocaleTimeString("en-US", options)
                    },
                    {
                        extend: 'csvHtml5',
                        title: 'Booking Records ' + date.toLocaleTimeString("en-US", options)
                    }
                ],
                "ordering": false,
                columnDefs: [{
                    orderable: false,
                    targets: "no-sort"
                }],
                "ajax": {
                    "serverSide": true,
                    "url": "/api/manual-booking-mis-list/?format=datatables",
                    headers: {"Authorization": localStorage.getItem("token")},
                    error: function (jqXHR, status, error) {
                if(jqXHR.status === "401"){
                    redirectToLogin(error);
                  }
            }
                },
                columns: [
                    {"data": "created_on"},
                    {"data": "shipment_date"},
                    {"data": "delivery_datetime"},
                    {"data": "booking_id"},
                    {
                        "data": "lr_number", "render": function (data) {
                            return data.split("\n").join("<br/>");
                        }
                    },
                    {
                        "data": "customer_placed_order_data",
                        "render": function (data) {
                            if (Object.keys(data).length === 0)
                                return "";
                            return data.name;
                        }
                    },
                    {
                        "data": "customer_placed_order_data",
                        "render": function (data) {
                            if (Object.keys(data).length === 0)
                                return "";
                            return data.code;
                        }
                    },
                    {"data": "consignor_name"},
                    {"data": "consignee_name"},
                    {
                        "data": "customer_to_be_billed_to_data",
                        "render": function (data) {
                            if (Object.keys(data).length === 0)
                                return "";
                            return data.name;
                        }
                    },
                    {
                        "data": "customer_to_be_billed_to_data",
                        "render": function (data) {
                            if (Object.keys(data).length === 0)
                                return "";
                            return data.code;
                        }
                    },
                    {"data": "from_city"},
                    {"data": "to_city"},
                    {
                        "data": "vehicle",
                        "render": function (data) {
                            if (Object.keys(data).length === 0)
                                return "";
                            return data.vehicle_number;
                        }
                    },
                    {
                        "data": "vehicle",
                        "render": function (data) {
                            if (Object.keys(data).length === 0)
                                return "";
                            return data.vehicle_type;
                        }
                    },
                    {"data": "charged_weight"},
                    {"data": "party_rate"},
                    {"data": "freight_revenue"},
                    {"data": "additional_charges_for_company"},
                    {"data": "invoice_remarks_for_additional_charges"},
                    {"data": "deductions_for_company"},
                    {"data": "invoice_remarks_for_deduction_discount"},
                    {"data": "total_amount_to_company"},
                    {"data": "refund_amount_due"},
                    {"data": "refund_amount_paid"},
                    {"data": "inward_payments_advance"},
                    {"data": "inward_payments_other"},
                    {"data": "tds_deducted_amount"},
                    {"data": "credit_amount_customer"},
                    {"data": "debit_amount_customer"},
                    {"data": "balance_for_customer"},
                    {"data": "invoice_status"},
                    {"data": "invoice_number"},
                    {"data": "billing_invoice_date"},
                    {
                        "data": "supplier_data",
                        "render": function (data) {
                            if (Object.keys(data).length === 0)
                                return "";
                            return data.name;
                        }
                    },
                    {
                        "data": "supplier_data",
                        "render": function (data) {
                            if (Object.keys(data).length === 0)
                                return "";
                            return data.code;
                        }
                    },
                    {"data": "supplier_charged_weight"},
                    {"data": "supplier_rate"},
                    {"data": "supplier_freight"},
                    {"data": "loading_charge"},
                    {"data": "unloading_charge"},
                    {"data": "detention_charge"},
                    {"data": "other_deduction"},
                    {"data": "remarks_about_deduction"},
                    {"data": "tds_deducted_supplier"},
                    {"data": "total_amount_to_owner"},
                    {"data": "total_out_ward_amount"},
                    {"data": "credit_amount_supplier"},
                    {"data": "debit_amount_supplier"},
                    {"data": "balance_amt_payable"},
                    {"data": "pod_status"},
                    {
                        "data": "source_office",
                        "render": function (data) {
                            if (Object.keys(data).length === 0)
                                return "";
                            return data.branch_name;
                        }
                    },
                    {
                        "data": "destination_office",
                        "render": function (data) {
                            if (Object.keys(data).length === 0)
                                return "";
                            return data.branch_name;
                        }
                    }
                ],
                "language": {
                    "processing": "<img  src='/static/aaho/images/loader.gif' />"
                }
            });
        });
    </script>
    <!-- /Datatables -->
{% endblock %}