{#{% extends "team/base.html" %}#}
{% load user_tags %}
{% load staticfiles %}
{% block css %}

    <!-- Datatables -->
    <link href="{% static "vendor/datatable/Bootstrap3/DataTables/DataTables-1.10.16/css/dataTables.bootstrap.min.css" %}"
          rel="stylesheet" type="text/css">
    <link href="{% static "vendor/datatable/Bootstrap3/DataTables/Buttons-1.5.1/css/buttons.bootstrap.min.css" %}"
          rel="stylesheet" type="text/css">
    <link href="{% static "vendor/datatable/Bootstrap3/DataTables/FixedHeader-3.1.3/css/fixedHeader.bootstrap.min.css" %}"
          rel="stylesheet" type="text/css">
    <link href="{% static "vendor/datatable/Bootstrap3/DataTables/Responsive-2.2.1/css/responsive.bootstrap.min.css" %}"
          rel="stylesheet" type="text/css">
    <link href="{% static "vendor/datatable/Bootstrap3/DataTables/Scroller-1.4.4/css/scroller.bootstrap.min.css" %}"
          rel="stylesheet" type="text/css">
    <!-- Datatables -->

{% endblock %}
{% block pageTitle %}
    <h3 class="titleTop">Bookings</h3>
{% endblock %}
{% block content %}
    {#    <div class="right_col" role="main">#}
    <div class="clearfix"></div>
    <div class="row">
        <div class="col-md-12 col-sm-12 col-xs-12">
            <div class="x_panel">
                <div class="x_content">
                    <table id="booking-data-table"
                           class="table table-striped table-bordered dt-responsive nowrap"
                           cellspacing="0" width="100%" data-page-length='25'>
                        <thead>
                        <tr>

                            <th>Date</th>
                            <th>Booking ID</th>
                            <th>LR Number</th>
                            <th>Company Name</th>
                            <th>Company Code</th>
                            <th>Supplier Name</th>
                            <th>From</th>
                            <th>To</th>
                            <th>Lorry No.</th>
                            {#                            {% if not user|has_group:"emp_group3" %}#}
                            <th>Total Amount to Company</th>
                            <th>Party Weight</th>
                            <th>Party Rate</th>
                            <th>Customer's Balance</th>
                            <th>Refund Amt</th>
                            <th>TDS</th>
                            <th>Billed Customer</th>
                            <th>Billed Cust Code</th>
                            <th>Invoice Number</th>
                            <th>Invoice Date</th>
                            {#                            {% endif %}#}
                            <th>Total Amount to Owner</th>
                            <th>Supplier Weight</th>
                            <th>Supplier Rate</th>
                            <th>Supplier's Balance</th>
                            <th>POD Status</th>
                            <th>Invoice Status</th>
                            <th>Inward Payment Status</th>
                            <th>Outward Payment Status</th>
                            <th>Source Office</th>
                            <th>Destination Office</th>
                            <th>Delivered Date</th>
                            <th>Id</th>
                            <th>status_color_code</th>

                        </tr>
                        </thead>
                    </table>
                </div>
                <div>
                    <table class="countries_list pull-right" style="width: 40%">
                        <caption><h4>Color Coding for Booking ID Background</h4></caption>
                        <tbody>
                        <tr>
                            <td>Full payment received (zgreen)</td>
                            <td class="fs15 fw700 text-right condition4" width="25%"></td>
                        </tr>
                        <tr>
                            <td>POD not yet received (zred)</td>
                            <td class="fs15 fw700 text-right condition5" width="25%"></td>
                        </tr>
                        <tr>
                            <td>POD received but invoice not submitted(zorange)</td>
                            <td class="fs15 fw700 text-right condition2" width="25%"></td>
                        </tr>
                        <tr>
                            <td>POD received and invoice submitted(zpurple)</td>
                            <td class="fs15 fw700 text-right condition3" width="25%"></td>
                        </tr>
                        <tr>
                            <td>Rate details not yet entered(zblue)</td>
                            <td class="fs15 fw700 text-right condition1" width="25%"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    {#    </div>#}


    <!-- /page content -->
    <style>
        .size {
            height: 60em;
        }
    </style>
    <style>
        .condition1 {
            background: cornflowerblue;
        }

        .condition2 {
            background: orange;
        }

        .condition3 {
            background: purple;
        }

        .condition4 {
            background: darkseagreen;
        }

        .condition5 {
            background: indianred;
        }

        .hideColumn, .hidden {
            display: none !important;
        }

    </style>
{% endblock %}
{% block js %}
    <!-- Datatables -->
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/DataTables-1.10.16/js/jquery.dataTables.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/DataTables-1.10.16/js/dataTables.bootstrap.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/Buttons-1.5.1/js/dataTables.buttons.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/Buttons-1.5.1/js/buttons.bootstrap.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/Buttons-1.5.1/js/buttons.flash.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/Buttons-1.5.1/js/buttons.html5.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/Buttons-1.5.1/js/buttons.print.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/FixedHeader-3.1.3/js/dataTables.fixedHeader.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/KeyTable-2.3.2/js/dataTables.keyTable.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/Responsive-2.2.1/js/dataTables.responsive.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/Responsive-2.2.1/js/responsive.bootstrap.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/Scroller-1.4.4/js/dataTables.scroller.min.js" %}" type="text/javascript"></script>
    <script src="{% static "vendor/datatable/Bootstrap3/DataTables/JSZip-2.5.0/jszip.min.js" %}" type="text/javascript"></script>
    <!-- Datatables -->
    <script type="text/javascript" language="javascript" class="init">
        $(document).ready(function () {
            var date = new Date();
            var options = {
                weekday: "short", year: "numeric", month: "short",
                day: "numeric", hour: "2-digit", minute: "2-digit"
            };
            $('#booking-data-table').dataTable({
                "serverSide": true,
                "processing": true,
                dom: 'Bfrtip',
                lengthMenu: [
                    [10, 25, 50, 100, 500,1000,2000,3000, -1],
                    ['10 Records', '25 Records', '50 Records', '100 Records', '500 Records','1000 Records','2000 Records','3000 Records', 'All Records']
                ],
                buttons: [
                    'pageLength', {
                        extend: 'excelHtml5',
                        title: 'Booking Records ' + date.toLocaleTimeString("en-US", options)
                    },
                    {
                        extend: 'csvHtml5',
                        title: 'Booking Records ' + date.toLocaleTimeString("en-US", options)
                    }
                ],
                "ordering": false,
                columnDefs: [{
                    orderable: false,
                    targets: "no-sort"
                }],
                "ajax": {
                    "serverSide": true,
                    "url": "/api/team-manual-booking-list/?format=datatables&booking_data_category=partial_booking_page",
                    headers: {"Authorization": localStorage.getItem("token")},
                    data: function (d) {
                        $.extend(d);
                        var dt_params = $('.input-sm').val();
                        // Add dynamic parameters to the data object sent to the server
                        if (dt_params) {
                            $.extend(d, {search: dt_params});
                        }
                    },
                    error: function (jqXHR, status, error) {
                if(jqXHR.status === "401"){
                    redirectToLogin(error);
                  }
            }
                },
                columns: [

                    {data: "shipment_date"},
                    {
                        data: "booking_id",
                        "render": function (data, type, row, meta) {
                            return '<a href="javascript:;" data-url="/api/manual-booking-retrieve/' + row.id + '/" class="btn btn-default getAjaxPage" style="background: ' + row.status_color_code + '; color:white">' + data + '</a>';
                        }
                    },
                    {
                        data: "lr_numbers", "render": function (data) {
                            return data.split("\n").join("<br/>");
                        }
                    },
                    {data: "customer_placed_order_data.name"},
                    {data: "customer_placed_order_data.code"},
                    {data: "truck_broker_owner_name"},
                    {data: "from_city"},
                    {data: "to_city"},
                    {data: "vehicle_data.vehicle_number"},
                    {data: "total_amount_to_company", className: hideColumn()},
                    {data: "charged_weight", className: hideColumn()},
                    {data: "party_rate", className: hideColumn()},
                    {data: "balance_for_customer", className: hideColumn()},
                    {data: "refund_amount", className: hideColumn()},
                    {data: "tds_deducted_amount", className: hideColumn()},
                    {data: "customer_to_be_billed_to_data.name", className: hideColumn()},
                    {data: "customer_to_be_billed_to_data.code", className: hideColumn()},
                    {data: "invoice_number", className: hideColumn()},
                    {data: "billing_invoice_date", className: hideColumn()},
                    {data: "total_amount_to_owner"},
                    {data: "supplier_charged_weight"},
                    {data: "supplier_rate"},
                    {data: "balance_for_supplier"},
                    {data: "pod_status"},
                    {data: "invoice_status"},
                    {data: "inward_payment_status"},
                    {data: "outward_payment_status"},
                    {data: "source_office_data.branch_name"},
                    {data: "destination_office_data.branch_name"},
                    {data: "delivery_datetime"},
                    {data: "id", className: 'hidden'},
                    {data: "status_color_code", className: 'hidden'}
                ],
                "language": {
                    "processing": "<img  src='/static/aaho/images/loader.gif' />"
                },
            });
        });

        function hideColumn() {
            if (localStorage.getItem('emp_group') === "emp_group3") {
                return "hideColumn";
            }
            return "";
        }
    </script>
    <!-- /Datatables -->
{% endblock %}
